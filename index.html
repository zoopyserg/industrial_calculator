<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>Конфігуратор системи сонячних панелей</title>
    <!-- Vue.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <!-- Tailwind CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <!-- DaisyUI -->
    <link href="https://cdn.jsdelivr.net/npm/daisyui@2.14.1/dist/full.css" rel="stylesheet">
    <!-- Дополнительные стили -->
    <style>
        /* Стили для прогресс-бара */
        .step {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
        }
        .step-item {
            position: relative;
            flex: 1;
            text-align: center;
            cursor: pointer;
        }
        .step-item::before {
            content: '';
            position: absolute;
            top: 50%;
            left: -50%;
            width: 100%;
            height: 2px;
            background-color: #d1d5db;
            z-index: -1;
        }
        .step-item:first-child::before {
            display: none;
        }
        .step-item.active::before,
        .step-item.active .step-number {
            background-color: #3b82f6;
            color: #fff;
        }
        .step-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 30px;
            height: 30px;
            border-radius: 9999px;
            background-color: #d1d5db;
            margin-bottom: 5px;
        }
        /* Стили для выделения выбранного комплекта */
        .selected-kit {
            border: 2px solid #3b82f6;
            background-color: #e0f2fe;
        }
        /* Стили для выбранных панелей */
        .selected-panel {
            border: 2px solid #3b82f6;
            background-color: #e0f2fe;
        }
    </style>
</head>
<body class="bg-gray-200 min-h-screen flex items-center justify-center">
    <div id="app" class="max-w-6xl mx-auto py-10 px-5 bg-white rounded-lg shadow-lg">
        <h1 class="text-3xl font-bold text-center mb-6">Конфігуратор системи сонячних панелей</h1>

        <!-- Прогресс-бар -->
        <div class="step mb-6">
            <div class="step-item" :class="{ 'active': step >= 1 }" @click="goToStep(1)">
                <div class="step-number">1</div>
                <div class="step-title">Потужність</div>
            </div>
            <div class="step-item" :class="{ 'active': step >= 2 }" @click="goToStep(2)">
                <div class="step-number">2</div>
                <div class="step-title">Комплекти</div>
            </div>
            <div class="step-item" :class="{ 'active': step >= 3 }" @click="goToStep(3)">
                <div class="step-number">3</div>
                <div class="step-title">Живлення</div>
            </div>
            <div class="step-item" :class="{ 'active': step >= 4 }" @click="goToStep(4)">
                <div class="step-number">4</div>
                <div class="step-title">Підсумок</div>
            </div>
        </div>

        <!-- Шаг 1: Ввод мощности или расчет потребления -->
        <div v-if="step === 1">
            <h2 class="text-xl font-semibold mb-4">Крок 1: Введіть потужність та час автономної роботи</h2>
            <div class="mb-6">
                <label class="block mb-2 font-semibold">Потужність (Вт):</label>
                <input type="number" v-model.number="knownWatts" class="input input-bordered w-full" placeholder="Введіть потужність в ватах">
            </div>
            <div class="mb-6">
                <label class="block mb-2 font-semibold">Час автономної роботи (годин):</label>
                <input type="number" v-model.number="autonomyHours" class="input input-bordered w-full" placeholder="Введіть час в годинах">
            </div>
            <div class="mb-6" v-if="canProceed">
                <p class="font-semibold">Необхідна ємність акумулятора: {{ batteryCapacity }} А·год</p>
            </div>
            <div class="flex justify-between mt-6">
                <button class="py-2 px-4 bg-blue-500 text-white font-semibold rounded-lg cursor-pointer transition hover:bg-blue-600" @click="nextStep" :disabled="!canProceed">Далі</button>
                <button class="py-2 px-4 bg-gray-500 text-white font-semibold rounded-lg cursor-pointer transition hover:bg-gray-600" @click="goToApplianceSelection">Допомогти розрахувати</button>
            </div>
        </div>

        <!-- Шаг 1.2: Выбор бытовой техники -->
        <div v-if="step === 1.2">
            <h2 class="text-xl font-semibold mb-4">Крок 1: Оберіть побутові прилади</h2>
            <div class="mb-6">
                <h3 class="text-lg font-semibold mb-2">Швидкий вибір пакетів:</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div class="p-4 bg-gray-100 rounded-lg cursor-pointer hover:bg-gray-200" @click="selectPackage('basic')">
                        <h4 class="font-bold mb-2">Базовий</h4>
                        <p>Освітлення, зарядка телефонів, Wi-Fi роутер</p>
                    </div>
                    <div class="p-4 bg-gray-100 rounded-lg cursor-pointer hover:bg-gray-200" @click="selectPackage('comfort')">
                        <h4 class="font-bold mb-2">Комфорт</h4>
                        <p>Холодильник, телевізор, ноутбук</p>
                    </div>
                    <div class="p-4 bg-gray-100 rounded-lg cursor-pointer hover:bg-gray-200" @click="selectPackage('luxury')">
                        <h4 class="font-bold mb-2">Лакшері</h4>
                        <p>Кондиціонер, електроплита, пральна машина</p>
                    </div>
                    <div class="p-4 bg-gray-100 rounded-lg cursor-pointer hover:bg-gray-200" @click="resetSelection">
                        <h4 class="font-bold mb-2">Скинути вибір</h4>
                        <p>Очистити всі вибрані прилади</p>
                    </div>
                </div>
            </div>
            <div class="mb-6">
                <h3 class="text-lg font-semibold mb-2">Виберіть прилади та час їх використання:</h3>
                <div v-for="appliance in appliances" :key="appliance.name" class="mb-4">
                    <div class="flex items-center">
                        <input type="checkbox" v-model="appliance.selected" class="checkbox checkbox-primary mr-4" @change="updateSelection(appliance)">
                        <div class="w-full">
                            <div class="flex justify-between items-center">
                                <label class="font-semibold">{{ appliance.label }}</label>
                                <div class="flex items-center">
                                    <label class="mr-2">Кількість:</label>
                                    <input type="number" v-model.number="appliance.quantity" :disabled="!appliance.selected" class="input input-bordered w-16 mr-4">
                                    <label class="mr-2">Потужність (Вт):</label>
                                    <input type="number" v-model.number="appliance.power" :disabled="!appliance.selected" class="input input-bordered w-24 mr-4">
                                    <label class="mr-2">Годин/добу:</label>
                                    <input type="number" v-model.number="appliance.hours" :disabled="!appliance.selected" class="input input-bordered w-24">
                                </div>
                            </div>
                            <p class="text-gray-500">{{ appliance.description }}</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="mb-6">
                <p class="font-semibold">Загальна потужність: {{ calculatedWatts }} Вт</p>
                <p class="font-semibold">Загальне енергоспоживання: {{ calculatedEnergy }} Вт·год</p>
                <p class="font-semibold">Необхідна ємність акумулятора: {{ batteryCapacityFromAppliances }} А·год</p>
            </div>
            <div class="flex justify-between mt-6">
                <button class="py-2 px-4 bg-gray-500 text-white font-semibold rounded-lg cursor-pointer transition hover:bg-gray-600" @click="goToStep(1)">Назад</button>
                <button class="py-2 px-4 bg-blue-500 text-white font-semibold rounded-lg cursor-pointer transition hover:bg-blue-600" @click="calculateFromAppliances">Розрахувати потужність</button>
            </div>
        </div>

        <!-- Шаг 2: Предложение комплектов -->
        <div v-if="step === 2">
            <h2 class="text-xl font-semibold mb-4">Крок 2: Оберіть рекомендований комплект</h2>
            <div v-if="sortedKits.length > 0">
                <div v-for="kit in sortedKits" :key="kit.name" class="mb-6 p-4 bg-gray-100 rounded-lg" :class="{ 'selected-kit': kit === selectedKit }">
                    <div class="flex justify-between items-center">
                        <div>
                            <h3 class="font-bold text-lg">{{ kit.name }}</h3>
                            <p class="text-gray-500">{{ kit.description }}</p>
                            <p class="font-semibold">Потужність інвертора: {{ kit.power * 1000 }} Вт</p>
                            <p class="font-semibold">Ємність акумуляторів: {{ kit.batteryCapacity }} А·год</p>
                        </div>
                        <div class="text-right">
                            <p class="text-xl font-bold">₴{{ formatPrice(kit.totalPrice) }}</p>
                            <button class="py-2 px-4" :class="kit === selectedKit ? 'bg-gray-500 hover:bg-gray-600' : 'bg-green-500 hover:bg-green-600'" @click="selectKit(kit)" class="text-white font-semibold rounded-lg cursor-pointer transition mt-2">
                                {{ kit === selectedKit ? 'Обрано' : 'Обрати' }}
                            </button>
                        </div>
                    </div>
                    <div class="mt-4">
                        <button @click="kit.showDetails = !kit.showDetails" class="text-blue-500 hover:underline">
                            {{ kit.showDetails ? 'Приховати деталі' : 'Показати деталі' }}
                        </button>
                        <div v-if="kit.showDetails" class="mt-4">
                            <!-- Детали комплекта -->
                            <h4 class="font-semibold">Склад комплекту:</h4>
                            <ul class="list-disc list-inside">
                                <li><strong>Інвертор:</strong> {{ kit.inverter.model }} — ₴{{ formatPrice(kit.inverter.price) }}</li>
                                <li><strong>Акумулятори:</strong> {{ kit.batteries.quantity }} × {{ kit.batteries.model }} — ₴{{ formatPrice(kit.batteries.totalPrice) }}</li>
                                <li><strong>Сонячні панелі:</strong> {{ kit.panels.quantity }} × {{ kit.panels.model }} — ₴{{ formatPrice(kit.panels.totalPrice) }}</li>
                                <li><strong>Комплектуючі та монтаж:</strong> ₴{{ formatPrice(kit.accessories.price) }}</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div v-else>
                <p class="text-red-500">На жаль, немає комплектів, що відповідають вашим вимогам. Спробуйте змінити параметри.</p>
            </div>
            <div class="flex justify-between mt-6">
                <button class="py-2 px-4 bg-gray-500 text-white font-semibold rounded-lg cursor-pointer transition hover:bg-gray-600" @click="goToStep(1)">Назад</button>
                <!-- Убираем кнопку "Далі", так как переход происходит автоматически -->
            </div>
        </div>

        <!-- Шаг 3: Живлення -->
        <div v-if="step === 3">
            <h2 class="text-xl font-semibold mb-4">Крок 3: Оберіть спосіб живлення</h2>
            <!-- Добавлено саммари выбранного комплекта -->
            <div class="mb-6 p-4 bg-gray-50 rounded-lg">
                <h3 class="font-bold mb-2">Вибраний комплект:</h3>
                <p><strong>Інвертор:</strong> {{ selectedKit.inverter.model }}</p>
                <p><strong>Сонячні панелі:</strong> {{ selectedKit.panels.model }}, {{ selectedKit.panels.quantity }} шт.</p>
                <p><strong>Потужність панелей:</strong> {{ selectedKit.panels.totalPower }} Вт</p>
            </div>
            <div class="mb-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="p-4 bg-gray-100 rounded-lg">
                        <h3 class="font-bold mb-2">Сонячні панелі</h3>
                        <div class="mb-4">
                            <label class="block mb-2 font-semibold">Вкажіть бажану потужність сонячних панелей (Вт):</label>
                            <input type="number" v-model.number="solarPanelPower" class="input input-bordered w-full" placeholder="Введіть потужність">
                        </div>
                        <button class="py-2 px-4 bg-gray-500 text-white font-semibold rounded-lg cursor-pointer transition hover:bg-gray-600" @click="calculateSolarPanels">Допомогти вибрати</button>
                        <div v-if="solarPanelsNeeded > 0" class="mt-4">
                            <p class="font-semibold">Необхідно сонячних панелей: {{ solarPanelsNeeded }} шт.</p>
                        </div>
                        <p class="text-gray-500 mt-2">Ця функція допоможе вам розрахувати кількість сонячних панелей на основі бажаної потужності.</p>
                    </div>
                    <div class="p-4 bg-gray-100 rounded-lg">
                        <h3 class="font-bold mb-2">Розетка</h3>
                        <div class="mb-4">
                            <label class="block mb-2 font-semibold">Тип проводки:</label>
                            <select v-model="wiringType" class="select select-bordered w-full">
                                <option value="">Оберіть тип проводки</option>
                                <option value="copper">Мідна</option>
                                <option value="aluminum">Алюмінієва</option>
                            </select>
                        </div>
                        <div v-if="wiringType === 'aluminum'">
                            <p class="text-red-500">Обмеження потужності до 1000 Вт.</p>
                            <p class="font-semibold">Бажаєте замінити проводку?</p>
                            <button class="py-2 px-4 bg-yellow-500 text-white font-semibold rounded-lg cursor-pointer transition hover:bg-yellow-600" @click="replaceWiring">Замовити заміну проводки</button>
                            <button class="py-2 px-4 bg-red-500 text-white font-semibold rounded-lg cursor-pointer transition hover:bg-red-600 mt-2" @click="goToStep(2)">Обрати слабший комплект</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Добавлен выбор сонячних панелей -->
            <div class="mb-6">
                <h3 class="text-lg font-semibold mb-2">Оберіть сонячні панелі:</h3>
                <div v-if="filteredPanels.length > 0">
                    <div v-for="panel in filteredPanels" :key="panel.model" class="mb-4 p-4 bg-gray-100 rounded-lg" :class="{ 'selected-panel': panel === selectedPanel }">
                        <div class="flex justify-between items-center">
                            <div>
                                <h4 class="font-bold">{{ panel.model }}</h4>
                                <p>Потужність: {{ panel.power }} Вт</p>
                                <p>Ціна: ₴{{ formatPrice(panel.price) }} за шт.</p>
                            </div>
                            <button class="py-2 px-4" :class="panel === selectedPanel ? 'bg-gray-500 hover:bg-gray-600' : 'bg-green-500 hover:bg-green-600'" @click="selectPanel(panel)" class="text-white font-semibold rounded-lg cursor-pointer transition">
                                {{ panel === selectedPanel ? 'Обрано' : 'Обрати' }}
                            </button>
                        </div>
                    </div>
                </div>
                <div v-else>
                    <p class="text-red-500">Немає сонячних панелей, що відповідають вашим вимогам. Спробуйте змінити параметри.</p>
                </div>
            </div>

            <div class="flex justify-between mt-6">
                <button class="py-2 px-4 bg-gray-500 text-white font-semibold rounded-lg cursor-pointer transition hover:bg-gray-600" @click="goToStep(2)">Назад</button>
                <button class="py-2 px-4 bg-blue-500 text-white font-semibold rounded-lg cursor-pointer transition hover:bg-blue-600" @click="nextStep">Далі</button>
            </div>
        </div>

        <!-- Шаг 4: Итоговый заказ -->
        <div v-if="step === 4">
            <h2 class="text-xl font-semibold mb-4">Крок 4: Підсумок та налаштування</h2>
            <div class="bg-gray-100 p-4 rounded-lg space-y-4">
                <h3 class="font-bold text-lg">Вибраний комплект:</h3>
                <!-- Возможность изменить компоненты -->
                <div class="mb-4">
                    <h4 class="font-semibold">Інвертор:</h4>
                    <select v-model="selectedInverter" class="select select-bordered w-full">
                        <option v-for="inverter in inverters" :value="inverter">{{ inverter.model }} — ₴{{ formatPrice(inverter.price) }}</option>
                    </select>
                </div>
                <div class="mb-4">
                    <h4 class="font-semibold">Акумулятори:</h4>
                    <div v-for="battery in batteries" :key="battery.model" class="flex items-center mb-2">
                        <input type="radio" v-model="selectedBattery" :value="battery" class="radio radio-primary mr-2">
                        <label>{{ battery.model }} ({{ battery.type }}) — ₴{{ formatPrice(battery.price) }}</label>
                    </div>
                    <div class="flex items-center mt-2">
                        <label class="mr-2">Кількість:</label>
                        <input type="number" v-model.number="selectedBatteryQuantity" min="1" class="input input-bordered w-24">
                    </div>
                </div>
                <div class="mb-4">
                    <h4 class="font-semibold">Сонячні панелі:</h4>
                    <div>
                        <label>{{ selectedPanel.model }} — ₴{{ formatPrice(selectedPanel.price) }} за шт.</label>
                        <div class="flex items-center mt-2">
                            <label class="mr-2">Кількість:</label>
                            <input type="number" v-model.number="selectedPanelQuantity" min="0" class="input input-bordered w-24">
                        </div>
                    </div>
                </div>
                <div class="mb-4">
                    <h4 class="font-semibold">Комплектуючі та монтаж:</h4>
                    <p>₴{{ formatPrice(selectedKit.accessories.price) }}</p>
                </div>
                <div v-if="wiringReplacementSelected" class="mb-4">
                    <h4 class="font-semibold">Заміна проводки:</h4>
                    <p>₴100,000</p>
                </div>
                <div class="text-xl font-bold text-right">
                    <span>Загальна вартість: ₴{{ formatPrice(totalPrice) }}</span>
                </div>
            </div>
            <div class="flex justify-between mt-6">
                <button class="py-2 px-4 bg-gray-500 text-white font-semibold rounded-lg cursor-pointer transition hover:bg-gray-600" @click="goToStep(3)">Назад</button>
                <button class="py-2 px-4 bg-green-500 text-white font-semibold rounded-lg cursor-pointer transition hover:bg-green-600" @click="finish">Завершити</button>
            </div>
        </div>

        <!-- Шаг 5: Завершение -->
        <div v-if="step === 5">
            <h2 class="text-xl font-semibold mb-4">Підсумок</h2>
            <div class="bg-gray-100 p-4 rounded-lg space-y-4">
                <h3 class="font-bold text-lg">Вибраний комплект:</h3>
                <ul class="list-disc list-inside">
                    <li><strong>Інвертор:</strong> {{ selectedInverter.model }} — ₴{{ formatPrice(selectedInverter.price) }}</li>
                    <li><strong>Акумулятори:</strong> {{ selectedBatteryQuantity }} × {{ selectedBattery.model }} — ₴{{ formatPrice(selectedBattery.price * selectedBatteryQuantity) }}</li>
                    <li><strong>Сонячні панелі:</strong> {{ selectedPanelQuantity }} × {{ selectedPanel.model }} — ₴{{ formatPrice(selectedPanel.price * selectedPanelQuantity) }}</li>
                    <li><strong>Комплектуючі та монтаж:</strong> ₴{{ formatPrice(selectedKit.accessories.price) }}</li>
                    <li v-if="wiringReplacementSelected"><strong>Заміна проводки:</strong> ₴100,000</li>
                </ul>
                <div class="text-xl font-bold text-right">
                    <span>Загальна вартість: ₴{{ formatPrice(totalPrice) }}</span>
                </div>
            </div>
            <div class="mt-6">
                <h3 class="font-bold text-lg">Дякуємо за використання нашого конфігуратора!</h3>
            </div>
            <div class="flex justify-between mt-6">
                <button class="py-2 px-4 bg-gray-500 text-white font-semibold rounded-lg cursor-pointer transition hover:bg-gray-600" @click="startOver">Почати спочатку</button>
                <button class="py-2 px-4 bg-blue-500 text-white font-semibold rounded-lg cursor-pointer transition hover:bg-blue-600" @click="generatePDF">Зберегти в PDF</button>
            </div>
        </div>

    </div>

    <!-- Vue.js код -->
    <script>
        new Vue({
            el: '#app',
            data: {
                step: 1,
                knownWatts: null,
                autonomyHours: null,
                appliances: [
                    // Базовая категория
                    { name: 'led_lamp', label: 'LED лампа', power: 10, hours: 5, quantity: 5, selected: false, description: 'Освітлення', category: 'basic', defaultHours: 5, defaultQuantity: 5 },
                    { name: 'wifi_router', label: 'Wi-Fi роутер', power: 10, hours: 24, quantity: 1, selected: false, description: 'Інтернет', category: 'basic', defaultHours: 24, defaultQuantity: 1 },
                    { name: 'smartphone_charge', label: 'Зарядка смартфона', power: 5, hours: 3, quantity: 2, selected: false, description: 'Зарядка телефонів', category: 'basic', defaultHours: 3, defaultQuantity: 2 },
                    // Комфорт категория
                    { name: 'fridge', label: 'Холодильник', power: 150, hours: 8, quantity: 1, selected: false, description: 'Зберігання продуктів', category: 'comfort', defaultHours: 8, defaultQuantity: 1 },
                    { name: 'tv', label: 'Телевізор', power: 100, hours: 4, quantity: 1, selected: false, description: 'Розваги', category: 'comfort', defaultHours: 4, defaultQuantity: 1 },
                    { name: 'laptop', label: 'Ноутбук', power: 60, hours: 6, quantity: 1, selected: false, description: 'Робота та розваги', category: 'comfort', defaultHours: 6, defaultQuantity: 1 },
                    // Лакшери категория
                    { name: 'air_conditioner', label: 'Кондиціонер', power: 1000, hours: 6, quantity: 1, selected: false, description: 'Комфортна температура', category: 'luxury', defaultHours: 6, defaultQuantity: 1 },
                    { name: 'electric_stove', label: 'Електроплита', power: 2000, hours: 2, quantity: 1, selected: false, description: 'Приготування їжі', category: 'luxury', defaultHours: 2, defaultQuantity: 1 },
                    { name: 'washing_machine', label: 'Пральна машина', power: 500, hours: 1, quantity: 1, selected: false, description: 'Прання одягу', category: 'luxury', defaultHours: 1, defaultQuantity: 1 },
                ],
                kits: [
                    // Обновленные данные комплектов
                    {
                        name: 'Комплект 1 кВт',
                        description: 'Міні комплект для базових потреб.',
                        power: 1, // в кВт
                        inverter: { model: 'Inverter 1kW', price: 10000 },
                        batteries: { model: 'Battery 100Ah', quantity: 2, totalPrice: 20000 },
                        batteryCapacity: 200, // в А·год
                        panels: { model: 'Panel 250W', quantity: 4, price: 5000, totalPrice: 20000, totalPower: 1000 },
                        accessories: { price: 5000 },
                        totalPrice: 55000,
                        showDetails: false
                    },
                    {
                        name: 'Комплект 3 кВт',
                        description: 'Підходить для базових потреб.',
                        power: 3,
                        inverter: { model: 'Growatt SPF 3000T HVM', price: 15000 },
                        batteries: { model: 'Pylontech US2000B Plus', quantity: 2, totalPrice: 76000 },
                        batteryCapacity: 200,
                        panels: { model: 'Сонячна панель 330 Вт', quantity: 10, price: 5000, totalPrice: 50000, totalPower: 3300 },
                        accessories: { price: 15000 },
                        totalPrice: 156000,
                        showDetails: false
                    },
                    {
                        name: 'Комплект 5 кВт',
                        description: 'Підходить для базових та середніх потреб.',
                        power: 5,
                        inverter: { model: 'Growatt SPF 5000 ES', price: 22000 },
                        batteries: { model: 'Pylontech US2000B Plus', quantity: 4, totalPrice: 152000 },
                        batteryCapacity: 400,
                        panels: { model: 'Сонячна панель 330 Вт', quantity: 15, price: 5000, totalPrice: 75000, totalPower: 4950 },
                        accessories: { price: 20000 },
                        totalPrice: 269000,
                        showDetails: false
                    },
                    {
                        name: 'Комплект 8 кВт',
                        description: 'Для середніх та високих потреб.',
                        power: 8,
                        inverter: { model: 'Victron Multiplus-II 48/8000/110', price: 70000 },
                        batteries: { model: 'Pylontech US2000B Plus', quantity: 6, totalPrice: 228000 },
                        batteryCapacity: 600,
                        panels: { model: 'Сонячна панель 330 Вт', quantity: 24, price: 5000, totalPrice: 120000, totalPower: 7920 },
                        accessories: { price: 30000 },
                        totalPrice: 448000,
                        showDetails: false
                    },
                    // Добавьте дополнительные комплекты, если необходимо
                ],
                selectedKit: null,
                selectedInverter: null,
                selectedBattery: null,
                selectedBatteryQuantity: 1,
                selectedPanelQuantity: 0,
                inverters: [
                    { model: 'Inverter 1kW', power: 1, voltage: 24, price: 10000 },
                    { model: 'Growatt SPF 3000T HVM', power: 3, voltage: 24, price: 15000 },
                    { model: 'Growatt SPF 5000 ES', power: 5, voltage: 48, price: 22000 },
                    { model: 'Victron Multiplus-II 48/8000/110', power: 8, voltage: 48, price: 70000 },
                    // Добавьте другие инверторы
                ],
                batteries: [
                    { model: 'Battery 100Ah', capacity: 100, voltage: 12, price: 10000, type: 'AGM' },
                    { model: 'Pylontech US2000B Plus', capacity: 50, voltage: 48, price: 38000, type: 'LiFePO4' },
                    { model: 'LogicPower LP-GL 12-200', capacity: 200, voltage: 12, price: 11000, type: 'Гелева' },
                    { model: 'Delta GX 12-100', capacity: 100, voltage: 12, price: 6000, type: 'AGM' },
                    // Добавьте другие аккумуляторы
                ],
                panels: [
                    { model: 'Сонячна панель 330 Вт', power: 330, price: 5000 },
                    { model: 'Сонячна панель 250 Вт', power: 250, price: 4000 },
                    { model: 'Сонячна панель 500 Вт', power: 500, price: 8000 },
                    // Добавьте другие панели
                ],
                selectedPanel: null,
                additionalParams: {
                    goal: '',
                    reason: '',
                    location: ''
                },
                solarPanelPower: null,
                solarPanelsNeeded: 0,
                wiringType: '',
                wiringReplacementSelected: false,
            },
            computed: {
                canProceed() {
                    return this.knownWatts > 0 && this.autonomyHours > 0;
                },
                batteryCapacity() {
                    const voltage = 220; // Изменено на 220 В
                    const totalEnergy = this.knownWatts * this.autonomyHours;
                    return Math.ceil(totalEnergy / voltage);
                },
                selectedAppliances() {
                    return this.appliances.filter(appliance => appliance.selected);
                },
                calculatedWatts() {
                    return this.selectedAppliances.reduce((sum, appliance) => sum + (appliance.power * appliance.quantity), 0);
                },
                calculatedEnergy() {
                    return this.selectedAppliances.reduce((sum, appliance) => sum + (appliance.power * appliance.hours * appliance.quantity), 0);
                },
                batteryCapacityFromAppliances() {
                    const voltage = 220; // Изменено на 220 В
                    return Math.ceil(this.calculatedEnergy / voltage);
                },
                sortedKits() {
                    const requiredPower = this.knownWatts || this.calculatedWatts;
                    const requiredBatteryCapacity = this.batteryCapacity || this.batteryCapacityFromAppliances;
                    const filteredKits = this.kits.filter(kit => {
                        return (kit.power * 1000 >= requiredPower) && (kit.batteryCapacity >= requiredBatteryCapacity);
                    });
                    return filteredKits.sort((a, b) => {
                        const diffA = (a.power * 1000 - requiredPower) + (a.batteryCapacity - requiredBatteryCapacity);
                        const diffB = (b.power * 1000 - requiredPower) + (b.batteryCapacity - requiredBatteryCapacity);
                        return diffA - diffB;
                    });
                },
                filteredPanels() {
                    if (!this.solarPanelPower) return this.panels;
                    return this.panels.filter(panel => panel.power <= this.solarPanelPower);
                },
                totalPrice() {
                    const inverterPrice = this.selectedInverter ? this.selectedInverter.price : 0;
                    const batteryPrice = this.selectedBattery ? this.selectedBattery.price * this.selectedBatteryQuantity : 0;
                    const panelsPrice = this.selectedPanelQuantity * (this.selectedPanel ? this.selectedPanel.price : 0);
                    const accessoriesPrice = this.selectedKit.accessories.price;
                    const wiringPrice = this.wiringReplacementSelected ? 100000 : 0;
                    return inverterPrice + batteryPrice + panelsPrice + accessoriesPrice + wiringPrice;
                },
            },
            methods: {
                nextStep() {
                    if (this.step === 1 && this.canProceed) {
                        this.step = 2;
                    } else if (this.step === 2 && this.selectedKit) {
                        this.step = 3;
                    } else if (this.step === 3) {
                        this.step = 4;
                    } else if (this.step === 4) {
                        this.step = 5;
                    }
                },
                goToStep(stepNumber) {
                    if (stepNumber <= this.step) {
                        this.step = stepNumber;
                    }
                },
                goToApplianceSelection() {
                    this.step = 1.2;
                },
                selectPackage(category) {
                    this.appliances.forEach(appliance => {
                        if (category === 'luxury') {
                            appliance.selected = true;
                        } else if (category === 'comfort') {
                            appliance.selected = ['basic', 'comfort'].includes(appliance.category);
                        } else if (category === 'basic') {
                            appliance.selected = appliance.category === 'basic';
                        }
                        appliance.hours = appliance.defaultHours;
                        appliance.quantity = appliance.defaultQuantity;
                    });
                },
                resetSelection() {
                    this.appliances.forEach(appliance => {
                        appliance.selected = false;
                        appliance.hours = appliance.defaultHours;
                        appliance.quantity = appliance.defaultQuantity;
                    });
                },
                updateSelection(appliance) {
                    if (!appliance.selected) {
                        appliance.hours = appliance.defaultHours;
                        appliance.quantity = appliance.defaultQuantity;
                    }
                },
                calculateFromAppliances() {
                    this.knownWatts = this.calculatedWatts;
                    this.autonomyHours = Math.ceil(this.calculatedEnergy / this.calculatedWatts);
                    this.step = 2;
                },
                selectKit(kit) {
                    this.selectedKit = JSON.parse(JSON.stringify(kit));
                    this.selectedInverter = this.inverters.find(inv => inv.model === kit.inverter.model);
                    this.selectedBattery = this.batteries.find(bat => bat.model === kit.batteries.model);
                    this.selectedBatteryQuantity = kit.batteries.quantity;
                    this.selectedPanelQuantity = kit.panels.quantity;
                    this.selectedPanel = this.panels.find(p => p.model === kit.panels.model);
                    // Переходим на следующий шаг автоматически
                    this.nextStep();
                },
                calculateSolarPanels() {
                    const panelPower = 330; // Мощность одной панели
                    if (this.solarPanelPower) {
                        this.solarPanelsNeeded = Math.ceil(this.solarPanelPower / panelPower);
                    } else {
                        this.solarPanelsNeeded = 0;
                    }
                },
                replaceWiring() {
                    this.wiringReplacementSelected = true;
                    alert('Послуга заміни проводки додана до замовлення.');
                },
                selectPanel(panel) {
                    this.selectedPanel = panel;
                },
                finish() {
                    this.step = 5;
                },
                startOver() {
                    // Сброс всех данных
                    location.reload();
                },
                formatPrice(price) {
                    return price.toLocaleString('uk-UA');
                },
                generatePDF() {
                    // Реализуйте функцию генерації PDF
                    alert('Функція генерації PDF ще не реалізована.');
                }
            }
        });
    </script>
</body>
</html>
