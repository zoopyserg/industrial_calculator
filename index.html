<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Конфігуратор системи сонячних панелей</title>
    <!-- Vue.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <!-- Tailwind CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <!-- Подключение иконок Heroicons -->
    <script src="https://unpkg.com/heroicons@1.0.6/dist/outline.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@2.14.1/dist/full.css" rel="stylesheet">
    <style>
        .category-dropdown {
            cursor: pointer;
            position: relative;
        }

        .category-content {
            overflow: hidden; /* ensure smooth transitions */
            transition: max-height 0.3s ease-out;
        }

        .category-dropdown.open .category-content {
            display: block;
            max-height: 1000px; /* set a high max-height value to allow all content to be visible */
        }

        .category-dropdown:hover {
            background-color: #f3f4f6;
        }

        /* Add arrow indicator for dropdown */
        .category-dropdown::after {
            content: '>';
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            transition: transform 0.3s ease;
        }

        .category-dropdown.open::after {
            transform: translateY(-50%) rotate(90deg);
        }

        /* Styles for the total summary */
        .summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid #e5e7eb;
        }

        .summary-item:last-child {
            border-bottom: none;
        }

        /* Additional spacing for better readability */
        .custom-radio-label,
        .custom-checkbox-label {
            margin-left: 0.5rem;
        }

        .summary-buttons {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
    </style>
</head>
<body class="bg-gray-200 min-h-screen flex items-center justify-center">
    <div id="app" class="max-w-4xl mx-auto py-10 px-5 bg-white rounded-lg shadow-lg">
        <h1 class="text-3xl font-bold text-center mb-6">Конфігуратор системи сонячних панелей</h1>

        <!-- Шаг 1: Выбор типа системы -->
        <div v-if="step === 1">
            <h2 class="text-xl font-semibold mb-4">Крок 1: Оберіть тип системи</h2>
            <div class="space-y-4">
                <div
                    v-for="type in systemTypes"
                    :key="type.value"
                    @click="selectType(type.value)"
                    :class="['p-4 bg-gray-200 rounded-lg cursor-pointer border-2 transition transform duration-300 flex items-start',
                    { 'bg-blue-50 border-blue-500': selectedType === type.value }]"
                >
                    <input
                        type="radio"
                        :id="type.value"
                        v-model="selectedType"
                        :value="type.value"
                        class="radio radio-primary mr-4 mt-1"
                    />
                    <div>
                        <label :for="type.value" class="block text-lg font-semibold cursor-pointer custom-radio-label">{{ type.label }}</label>
                        <p class="text-gray-500 text-sm">{{ type.description }}</p>
                    </div>
                </div>
            </div>
            <div class="flex justify-between mt-6">
                <span></span>
                <button class="py-2 px-4 bg-blue-500 text-white font-semibold rounded-lg cursor-pointer transition transform duration-300 hover:bg-blue-600 hover:scale-105" @click="nextStep" :disabled="!selectedType">Далі</button>
            </div>
        </div>

        <!-- Шаг 2: Выбор опций -->
        <div v-if="step === 2">
            <h2 class="text-xl font-semibold mb-4">Крок 2: Оберіть опції</h2>
            <div v-for="category in categories" :key="category.name" class="mb-6">
                <div
                    class="category-dropdown bg-gray-100 p-4 rounded-lg"
                    @click="toggleCategory(category)"
                    :class="{ 'open': category.open }"
                >
                    <h3 class="text-lg font-semibold">{{ category.name }}</h3>
                    <p class="text-gray-500 text-sm">{{ category.description }}</p>
                </div>
                <div
                    v-if="category.open"
                    class="category-content pl-6 mt-2"
                >
                    <div v-for="option in category.options" :key="option.name" class="flex items-start mb-4">
                        <input
                            type="checkbox"
                            :id="option.name"
                            v-model="option.selected"
                            class="checkbox checkbox-primary mr-4 mt-1"
                        />
                        <div>
                            <label :for="option.name" class="block text-lg font-semibold cursor-pointer custom-checkbox-label">{{ option.label }}</label>
                            <p class="text-gray-500 text-sm">{{ option.description }}</p>
                            <p class="text-gray-800 font-semibold">Ціна: ₴{{ option.price }}</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="flex justify-between mt-6">
                <button class="py-2 px-4 bg-gray-500 text-white font-semibold rounded-lg cursor-pointer transition transform duration-300 hover:bg-gray-600 hover:scale-105" @click="prevStep">Назад</button>
                <button class="py-2 px-4 bg-blue-500 text-white font-semibold rounded-lg cursor-pointer transition transform duration-300 hover:bg-blue-600 hover:scale-105" @click="nextStep">Далі</button>
            </div>
        </div>

        <!-- Шаг 3: Количество панелей и другие параметры -->
        <div v-if="step === 3">
            <h2 class="text-xl font-semibold mb-4">Крок 3: Введіть кількість панелей та інші параметри</h2>
            <label class="block mb-4">
                Кількість панелей:
                <input
                    type="number"
                    v-model="panelCount"
                    min="1"
                    max="100"
                    class="input input-bordered w-full"
                >
            </label>
            <div class="flex items-center space-x-3 mb-6">
                <input
                    type="checkbox"
                    id="needBatteries"
                    v-model="needBatteries"
                    class="checkbox checkbox-primary mr-4 mt-1"
                >
                <label for="needBatteries" class="text-lg font-semibold">Потрібні акумулятори</label>
                <p class="text-gray-500 text-sm">Ціна: ₴500 за одиницю</p>
            </div>
            <div class="flex justify-between">
                <button class="py-2 px-4 bg-gray-500 text-white font-semibold rounded-lg cursor-pointer transition transform duration-300 hover:bg-gray-600 hover:scale-105" @click="prevStep">Назад</button>
                <button class="py-2 px-4 bg-blue-500 text-white font-semibold rounded-lg cursor-pointer transition transform duration-300 hover:bg-blue-600 hover:scale-105" @click="nextStep">Показати підсумок</button>
            </div>
        </div>

        <!-- Шаг 4: Итоговый заказ -->
        <div v-if="step === 4">
            <h2 class="text-xl font-semibold mb-4">Підсумок</h2>
            <div class="bg-gray-100 p-4 rounded-lg space-y-4">
                <div v-for="(option, index) in selectedOptions" :key="option.name" class="summary-item">
                    <div>
                        <span class="block font-semibold">{{ option.label }} (x{{ option.quantity }})</span>
                        <p class="text-gray-500 text-sm">{{ option.description }}</p>
                    </div>
                    <div class="summary-buttons">
                        <button @click="decrementQuantity(option)" class="py-1 px-2 bg-gray-300 text-gray-700 font-semibold rounded-lg cursor-pointer transition transform duration-300 hover:bg-gray-400">-</button>
                        <span>₴{{ option.price * option.quantity }}</span>
                        <button @click="incrementQuantity(option)" class="py-1 px-2 bg-gray-300 text-gray-700 font-semibold rounded-lg cursor-pointer transition transform duration-300 hover:bg-gray-400">+</button>
                        <button @click="removeOption(option)" class="py-1 px-1 bg-red-500 text-white font-semibold rounded-lg cursor-pointer transition transform duration-300 hover:bg-red-600">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="summary-item" v-if="needBatteries">
                    <div>
                        <span class="block font-semibold">Акумулятори</span>
                        <p class="text-gray-500 text-sm">Для зберігання енергії</p>
                    </div>
                    <span>₴{{ 500 * panelCount }}</span>
                </div>
                <div class="summary-item">
                    <div>
                        <span class="block font-semibold">Кількість панелей</span>
                        <p class="text-gray-500 text-sm">Кількість сонячних панелей у системі</p>
                    </div>
                    <span>{{ panelCount }}</span>
                </div>
                <div class="text-xl font-bold text-right">
                    <span>Загальна вартість: ₴{{ totalCost }}</span>
                </div>
            </div>
            <div class="flex justify-between mt-6">
                <button class="py-2 px-4 bg-gray-500 text-white font-semibold rounded-lg cursor-pointer transition transform duration-300 hover:bg-gray-600 hover:scale-105" @click="prevStep">Назад</button>
                <button class="py-2 px-4 bg-green-500 text-white font-semibold rounded-lg cursor-pointer transition transform duration-300 hover:bg-green-600 hover:scale-105" @click="addMoreOptions">Додати більше</button>
                <button class="py-2 px-4 bg-blue-500 text-white font-semibold rounded-lg cursor-pointer transition transform duration-300 hover:bg-blue-600 hover:scale-105" @click="generatePDF">Зберегти в PDF</button>
            </div>
        </div>
    </div>

    <!-- Vue.js код -->
    <script>
        new Vue({
            el: '#app',
            data: {
                step: 1,
                selectedType: '',
                panelCount: 1,
                needBatteries: false,
                systemTypes: [
                    { label: 'Автономна система', value: 'autonomous', description: 'Система, яка працює незалежно від електромережі.' },
                    { label: 'Мережева система', value: 'grid', description: 'Система, яка підключена до електромережі.' },
                    { label: 'Гібридна система', value: 'hybrid', description: 'Комбінація автономної та мережевої системи.' },
                ],
                categories: [
                    {
                        name: 'Кріплення та підтримка',
                        description: 'Обладнання для кріплення та підтримки сонячних панелей.',
                        open: false,
                        options: [
                            { name: 'mounting', label: 'Кріплення для панелей', description: 'Надійне кріплення для вашої сонячної панелі.', price: 200, selected: false, quantity: 1 },
                            { name: 'support', label: 'Підтримка панелей', description: 'Додаткова підтримка для панелей.', price: 150, selected: false, quantity: 1 }
                        ]
                    },
                    {
                        name: 'Контролери та інвертори',
                        description: 'Контролери заряду та інвертори для керування вашою системою.',
                        open: false,
                        options: [
                            { name: 'controller', label: 'Контролер заряду', description: 'Керує процесом зарядки акумуляторів.', price: 150, selected: false, quantity: 1 },
                            { name: 'inverter', label: 'Інвертор', description: 'Перетворює постійний струм на змінний.', price: 700, selected: false, quantity: 1 }
                        ]
                    },
                    {
                        name: 'Акумулятори та зберігання енергії',
                        description: 'Акумулятори для зберігання енергії.',
                        open: false,
                        options: [
                            { name: 'battery', label: 'Акумуляторна батарея', description: 'Зберігає енергію для подальшого використання.', price: 500, selected: false, quantity: 1 },
                            { name: 'ecoflow', label: 'EcoFlow станція', description: 'Мобільна станція зберігання енергії.', price: 1000, selected: false, quantity: 1 }
                        ]
                    },
                    {
                        name: 'Моніторинг та керування',
                        description: 'Системи моніторингу та керування для вашої системи.',
                        open: false,
                        options: [
                            { name: 'monitoring', label: 'Система моніторингу', description: 'Відстежує стан системи та ефективність роботи.', price: 300, selected: false, quantity: 1 },
                            { name: 'control', label: 'Керуючий пристрій', description: 'Дистанційне керування системою.', price: 250, selected: false, quantity: 1 }
                        ]
                    }
                ]
            },
            computed: {
                selectedOptions() {
                    return this.categories.flatMap(category => category.options.filter(option => option.selected));
                },
                totalCost() {
                    let cost = this.selectedOptions.reduce((sum, option) => sum + (option.price * option.quantity), 0);
                    if (this.needBatteries) cost += 500 * this.panelCount;
                    return cost;
                }
            },
            methods: {
                selectType(type) {
                    this.selectedType = type;
                },
                toggleCategory(category) {
                    category.open = !category.open;
                    console.log(category.open);
                    console.log(category.name);
                    console.log(category.options);
                },
                incrementQuantity(option) {
                    option.quantity++;
                },
                decrementQuantity(option) {
                    if (option.quantity > 1) option.quantity--;
                },
                nextStep() {
                    this.step++;
                },
                prevStep() {
                    this.step--;
                },
                removeOption(option) {
                    option.selected = false;
                    option.quantity = 1; // Сбросить количество при удалении
                },
                addMoreOptions() {
                    this.step = 2;
                },
                generatePDF() {
                   // Создаем HTML-шаблон для инвойса
                   const invoiceContent = `
                       <div style="font-family: Arial, sans-serif; padding: 20px;">
                           <h1 style="text-align: center;">Інвойс</h1>
                           <h2>Вибрані опції:</h2>
                           <table style="width: 100%; border-collapse: collapse;">
                               <thead>
                                   <tr>
                                       <th style="border: 1px solid #dddddd; padding: 8px;">Назва</th>
                                       <th style="border: 1px solid #dddddd; padding: 8px;">Опис</th>
                                       <th style="border: 1px solid #dddddd; padding: 8px;">Кількість</th>
                                       <th style="border: 1px solid #dddddd; padding: 8px;">Ціна за одиницю</th>
                                       <th style="border: 1px solid #dddddd; padding: 8px;">Загальна ціна</th>
                                   </tr>
                               </thead>
                               <tbody>
                                   ${this.selectedOptions.map(option => `
                                   <tr>
                                       <td style="border: 1px solid #dddddd; padding: 8px;">${option.label}</td>
                                       <td style="border: 1px solid #dddddd; padding: 8px;">${option.description}</td>
                                       <td style="border: 1px solid #dddddd; padding: 8px; text-align: center;">${option.quantity}</td>
                                       <td style="border: 1px solid #dddddd; padding: 8px; text-align: center;">₴${option.price}</td>
                                       <td style="border: 1px solid #dddddd; padding: 8px; text-align: center;">₴${option.price * option.quantity}</td>
                                   </tr>
                                   `).join('')}
                                   ${this.needBatteries ? `
                                   <tr>
                                       <td style="border: 1px solid #dddddd; padding: 8px;">Акумулятори</td>
                                       <td style="border: 1px solid #dddddd; padding: 8px;">Для зберігання енергії</td>
                                       <td style="border: 1px solid #dddddd; padding: 8px; text-align: center;">${this.panelCount}</td>
                                       <td style="border: 1px solid #dddddd; padding: 8px; text-align: center;">₴500</td>
                                       <td style="border: 1px solid #dddddd; padding: 8px; text-align: center;">₴${500 * this.panelCount}</td>
                                   </tr>
                                   ` : ''}
                               </tbody>
                               <tfoot>
                                   <tr>
                                       <td colspan="4" style="border: 1px solid #dddddd; padding: 8px; text-align: right;"><strong>Загальна вартість:</strong></td>
                                       <td style="border: 1px solid #dddddd; padding: 8px; text-align: center;"><strong>₴${this.totalCost}</strong></td>
                                   </tr>
                               </tfoot>
                           </table>
                           <p style="text-align: center; margin-top: 20px;">Дякуємо за ваш вибір!</p>
                       </div>
                   `;

                   // Создаем PDF с использованием html2pdf.js
                   const options = {
                       margin: 1,
                       filename: 'invoice.pdf',
                       image: { type: 'jpeg', quality: 0.98 },
                       html2canvas: { scale: 2 },
                       jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
                   };
                   html2pdf().from(invoiceContent).set(options).save();
               }
            }
        });
    </script>
</body>
</html>
